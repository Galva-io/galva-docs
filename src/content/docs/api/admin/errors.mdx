---
title: Error Handling
description: Comprehensive guide to Admin API error codes and handling strategies
---

The Admin API uses standard HTTP status codes to indicate success or failure. All errors return a consistent JSON format with details to help you debug issues.

## HTTP Status Codes

| Status Code | Meaning | When It Occurs |
|-------------|---------|----------------|
| `200 OK` | Success | Request completed successfully |
| `202 Accepted` | Accepted | Request accepted for async processing (batch endpoints) |
| `400 Bad Request` | Validation Error | Invalid or missing request parameters |
| `401 Unauthorized` | Authentication Error | Invalid, missing, or revoked API key |
| `429 Too Many Requests` | Rate Limit Error | Too many requests in a short period |
| `500 Internal Server Error` | Server Error | Unexpected error on Galva's side |

---

## Error Response Format

All error responses follow this structure:

```json title="Error Response Format"
{
  "error": {
    "type": "error_type",
    "message": "Human-readable error description",
    "field": "optional_field_name",
    "details": {}
  }
}
```

### Fields

| Field | Type | Description |
|-------|------|-------------|
| `type` | string | Machine-readable error type for programmatic handling |
| `message` | string | Human-readable description of the error |
| `field` | string | (Optional) Specific field that caused the error |
| `details` | object | (Optional) Additional context about the error |

---

## Error Types

### 1. Validation Errors (400)

Returned when request data is invalid or missing required fields.

#### Missing Required Field

```json title="400 Missing Required Field"
{
  "error": {
    "type": "validation_error",
    "message": "userId is required"
  }
}
```

**Common Causes:**
- Missing `userId` in request body
- Missing `type` in events endpoint
- Missing `planId` in events endpoint

**Solution:**
Ensure all required fields are included in your request. Check endpoint documentation for required fields.

#### Invalid Field Format

```json
{
  "error": {
    "type": "validation_error",
    "message": "Invalid email format",
    "field": "traits.email"
  }
}
```

**Common Causes:**
- Email doesn't match valid format (e.g., `invalid-email`)
- Date is not ISO 8601 format
- Invalid enum value (e.g., invalid `status` value)

**Solution:**
Validate data before sending. Ensure dates are ISO 8601 formatted and emails match standard format.

#### Invalid Event Type

```json
{
  "error": {
    "type": "validation_error",
    "message": "Invalid event type: 'subscribe'. Did you mean 'subscribed'?"
  }
}
```

**Common Causes:**
- Typo in event type (e.g., `subscribe` instead of `subscribed`)
- Using non-existent event type

**Solution:**
Use one of the valid event types: `subscribed`, `renewed`, `cancelled`, `reactivated`, `payment_failed`, `expired`

#### Batch Size Exceeded

```json
{
  "error": {
    "type": "validation_error",
    "message": "Maximum 1,000 users per request. Received: 1,500"
  }
}
```

**Common Causes:**
- Sending more than 1,000 users in `/batch-identify`

**Solution:**
Split large batches into multiple requests of 1,000 users or fewer.

#### Invalid Array Index

```json
{
  "error": {
    "type": "validation_error",
    "message": "Missing userId in users[3]",
    "field": "users[3].userId",
    "index": 3
  }
}
```

**Common Causes:**
- Invalid data in batch request at specific index

**Solution:**
Fix the data at the indicated index and retry.

---

### 2. Authentication Errors (401)

Returned when API key is invalid, missing, or revoked.

#### Invalid API Key

```json title="401 Invalid API Key"
{
  "error": {
    "type": "authentication_error",
    "message": "Invalid API key. Please check your Authorization header."
  }
}
```

**Common Causes:**
- API key is malformed or incorrect
- API key belongs to a different app
- Typo in the API key

**Solution:**
1. Verify your API key in app settings
2. Ensure you're using the correct key for the target app
3. Check for leading/trailing whitespace in the key

#### Missing Authorization Header

```json
{
  "error": {
    "type": "authentication_error",
    "message": "Authorization header is required"
  }
}
```

**Common Causes:**
- `Authorization` header is missing from request
- Header is named incorrectly (e.g., `Auth` instead of `Authorization`)

**Solution:**
Include the header: `Authorization: Bearer sk_admin_xxxxxxxxxxxxxxxxxx`

#### Revoked API Key

```json
{
  "error": {
    "type": "authentication_error",
    "message": "This API key has been revoked. Please generate a new key in app settings."
  }
}
```

**Common Causes:**
- API key was revoked in app settings
- Using an old key after rotation

**Solution:**
Generate a new API key in your app settings and update your application.

---

### 3. Rate Limit Errors (429)

Returned when you exceed the allowed request rate.

#### Standard Rate Limit

```json title="429 Rate Limit Exceeded"
{
  "error": {
    "type": "rate_limit_error",
    "message": "Rate limit exceeded. Please retry after 60 seconds.",
    "details": {
      "retryAfter": 60,
      "limit": 100,
      "window": "1 minute"
    }
  }
}
```

**Common Causes:**
- Exceeding 100 requests per minute for standard endpoints
- Burst of requests in a short time

**Solution:**
Implement exponential backoff and respect the `retryAfter` value.

#### Batch Rate Limit

```json
{
  "error": {
    "type": "rate_limit_error",
    "message": "Batch identify rate limit exceeded. Maximum 10 requests per minute.",
    "details": {
      "retryAfter": 60,
      "limit": 10,
      "window": "1 minute"
    }
  }
}
```

**Common Causes:**
- Exceeding 10 requests per minute for `/batch-identify`

**Solution:**
Space out batch requests (6+ seconds between requests) or implement retry logic.

---

### 4. Server Errors (500)

Returned when an unexpected error occurs on Galva's side.

```json
{
  "error": {
    "type": "server_error",
    "message": "An unexpected error occurred. Please try again later.",
    "details": {
      "requestId": "req_abc123"
    }
  }
}
```

**Common Causes:**
- Temporary service disruption
- Database issues
- Unexpected system error

**Solution:**
1. Retry the request after a short delay
2. If the issue persists, contact support with the `requestId`

---

## Error Handling Strategies

### 1. Retry Logic with Exponential Backoff

For transient errors (rate limits, server errors), implement exponential backoff:

```javascript title="retry-logic.js" collapse={1-18}
async function callApiWithRetry(requestFn, maxRetries = 3) {
  for (let attempt = 0; attempt < maxRetries; attempt++) {
    try {
      return await requestFn();
    } catch (error) {
      const status = error.response?.status;

      // Don't retry client errors (except rate limits)
      if (status >= 400 && status < 500 && status !== 429) {
        throw error;
      }

      // Calculate backoff delay
      const baseDelay = 1000; // 1 second
      const delay = baseDelay * Math.pow(2, attempt);

      console.log(`Attempt ${attempt + 1} failed. Retrying in ${delay}ms...`);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }

  throw new Error('Max retries exceeded');
}

// Usage
const result = await callApiWithRetry(async () => {
  return await fetch('https://api.galva.io/v1/identify', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${apiKey}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ userId: 'user_123', traits: { email: 'test@example.com' } })
  });
});
```

### 2. Respect Rate Limit Headers

When you receive a 429 error, respect the `retryAfter` value:

```javascript title="rate-limit-handler.js" collapse={1-8}
async function callApiWithRateLimit(requestFn) {
  try {
    return await requestFn();
  } catch (error) {
    if (error.response?.status === 429) {
      const retryAfter = error.response.data?.error?.details?.retryAfter || 60;

      console.log(`Rate limited. Waiting ${retryAfter} seconds...`);
      await new Promise(resolve => setTimeout(resolve, retryAfter * 1000));

      // Retry once after waiting
      return await requestFn();
    }
    throw error;
  }
}
```

### 3. Validate Data Before Sending

Prevent validation errors by validating data client-side:

```javascript title="validation.js" collapse={1-15}
function validateIdentifyRequest(userId, traits) {
  if (!userId || typeof userId !== 'string') {
    throw new Error('userId must be a non-empty string');
  }

  if (traits?.email && !isValidEmail(traits.email)) {
    throw new Error('Invalid email format');
  }

  if (traits?.ltv && (typeof traits.ltv !== 'number' || traits.ltv < 0)) {
    throw new Error('ltv must be a positive number');
  }

  return true;
}

function isValidEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

// Usage
try {
  validateIdentifyRequest(userId, traits);
  await identifyUser(userId, traits);
} catch (error) {
  console.error('Validation failed:', error.message);
}
```

### 4. Handle Specific Error Types

```javascript title="error-handler.js" collapse={1-18}
async function identifyUser(userId, traits) {
  try {
    const response = await fetch('https://api.galva.io/v1/identify', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ userId, traits })
    });

    if (!response.ok) {
      const error = await response.json();
      throw { status: response.status, ...error };
    }

    return await response.json();
  } catch (error) {
    switch (error.status) {
      case 400:
        console.error('Validation error:', error.error.message);
        // Log for debugging, don't retry
        break;

      case 401:
        console.error('Authentication error:', error.error.message);
        // Alert team to rotate API key
        alertTeam('API key invalid or revoked');
        break;

      case 429:
        console.log('Rate limited, retrying...');
        // Wait and retry
        const retryAfter = error.error.details?.retryAfter || 60;
        await new Promise(resolve => setTimeout(resolve, retryAfter * 1000));
        return await identifyUser(userId, traits);

      case 500:
        console.error('Server error, retrying...');
        // Retry with exponential backoff
        await new Promise(resolve => setTimeout(resolve, 5000));
        return await identifyUser(userId, traits);

      default:
        console.error('Unexpected error:', error);
        throw error;
    }
  }
}
```

### 5. Circuit Breaker Pattern

For high-volume applications, implement a circuit breaker to prevent cascading failures:

```javascript title="circuit-breaker.js" collapse={1-35}
class CircuitBreaker {
  constructor(threshold = 5, timeout = 60000) {
    this.failureCount = 0;
    this.threshold = threshold;
    this.timeout = timeout;
    this.state = 'CLOSED'; // CLOSED, OPEN, HALF_OPEN
    this.nextAttempt = Date.now();
  }

  async call(requestFn) {
    if (this.state === 'OPEN') {
      if (Date.now() < this.nextAttempt) {
        throw new Error('Circuit breaker is OPEN');
      }
      this.state = 'HALF_OPEN';
    }

    try {
      const result = await requestFn();
      this.onSuccess();
      return result;
    } catch (error) {
      this.onFailure();
      throw error;
    }
  }

  onSuccess() {
    this.failureCount = 0;
    this.state = 'CLOSED';
  }

  onFailure() {
    this.failureCount++;
    if (this.failureCount >= this.threshold) {
      this.state = 'OPEN';
      this.nextAttempt = Date.now() + this.timeout;
      console.log(`Circuit breaker opened. Will retry at ${new Date(this.nextAttempt)}`);
    }
  }
}

// Usage
const breaker = new CircuitBreaker(5, 60000);

async function callApiSafely() {
  try {
    return await breaker.call(async () => {
      return await identifyUser('user_123', { email: 'test@example.com' });
    });
  } catch (error) {
    console.error('Request failed:', error.message);
  }
}
```

---

## Best Practices

### 1. Log Request IDs

Always log request IDs from error responses for debugging:

```javascript
try {
  await identifyUser(userId, traits);
} catch (error) {
  console.error('API Error:', {
    message: error.error.message,
    type: error.error.type,
    requestId: error.error.details?.requestId,
    userId: userId
  });
}
```

### 2. Monitor Error Rates

Track error rates to detect issues early:

```javascript
const errorMetrics = {
  validation: 0,
  authentication: 0,
  rateLimit: 0,
  server: 0
};

function trackError(errorType) {
  errorMetrics[errorType]++;

  // Alert if error rate exceeds threshold
  if (errorMetrics[errorType] > 100) {
    alertTeam(`High ${errorType} error rate detected`);
  }
}
```

### 3. Implement Graceful Degradation

Don't let API errors break your application:

```javascript
async function updateUserProfile(userId, email) {
  try {
    // Update in your database
    await db.updateUser(userId, { email });

    // Sync to Galva (non-blocking)
    identifyUser(userId, { email }).catch(error => {
      console.error('Galva sync failed:', error);
      // Queue for retry later
      queue.add({ userId, email });
    });

    return { success: true };
  } catch (error) {
    console.error('Database update failed:', error);
    return { success: false, error: error.message };
  }
}
```

### 4. Use Idempotency

Since `/identify` is idempotent, it's safe to retry:

```javascript
// Safe to call multiple times with the same data
await identifyUser('user_123', { email: 'test@example.com' });
await identifyUser('user_123', { email: 'test@example.com' }); // Won't cause issues
```

### 5. Test Error Scenarios

Test your error handling code:

```javascript
// Mock API error responses for testing
async function testErrorHandling() {
  // Test 400 validation error
  await expect(
    identifyUser('', { email: 'test@example.com' })
  ).rejects.toThrow('userId is required');

  // Test 401 authentication error
  await expect(
    identifyUserWithInvalidKey('user_123', {})
  ).rejects.toThrow('Invalid API key');

  // Test 429 rate limit
  await expect(
    sendManyRequests(150)
  ).rejects.toThrow('Rate limit exceeded');
}
```

---

## Error Reference Quick Guide

| Error Type | Status | Retry? | Action |
|------------|--------|--------|--------|
| `validation_error` | 400 | No | Fix request data |
| `authentication_error` | 401 | No | Check API key |
| `rate_limit_error` | 429 | Yes | Wait and retry |
| `server_error` | 500 | Yes | Retry with backoff |

---

## Getting Help

If you continue to experience errors:

1. **Check Status Page** - Visit status.galva.io for service status
2. **Review Documentation** - Ensure your request format matches examples
3. **Validate API Key** - Confirm your key is valid in app settings
4. **Contact Support** - Include error details and request ID

### Support Checklist

When contacting support, include:
- Full error response (JSON)
- Request ID from error details
- Timestamp of the error
- Sample request payload (remove sensitive data)
- Your app ID
- Steps to reproduce

---

## Related Pages

- [Authentication](/api/admin/authentication) - API key management and security
- [Identify](/api/admin/identify) - User sync endpoint reference
- [Events](/api/admin/events) - Event tracking endpoint reference
- [Batch Identify](/api/admin/batch-identify) - Bulk import endpoint reference
